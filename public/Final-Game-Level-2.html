<!DOCTYPE html>
<html>
<head>
    <title>Canvas Example</title>
    <style>
        body {
            background-color: Brown;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <canvas id="myCanvas" width="600" height="400"></canvas>
    <script>
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");

        var playerWidth = 20;
        var playerHeight = 20;
        var playerX = (canvas.width - playerWidth) / 2;
        var playerY = (canvas.height - playerHeight) / 2;
        var playerSpeed = 5;
        var keys = {};

        var rectWidth = 20;
        var rectHeight = playerHeight;
        var rect1Y = 0;
        var rect2Y = canvas.height - rectHeight;
        var rectSpeed = 2;
        var rectDirection1 = 1;
        var rectDirection2 = -1;
        var bulletRadius = 5;
        var bulletSpeed = 3;
        var bullets = [];

        var isPlayerAlive = true;
        var deathScreenElement = document.createElement('div');
        var restartButtonElement = document.createElement('button');

        document.addEventListener("keydown", function(event) {
            keys[event.key] = true;
        });

        document.addEventListener("keyup", function(event) {
            keys[event.key] = false;
        });

        function update() {
            if (isPlayerAlive) {
                if (keys["w"] && playerY > 0) {
                    playerY -= playerSpeed;
                }
                if (keys["a"] && playerX > 0) {
                    playerX -= playerSpeed;
                }
                if (keys["s"] && playerY < canvas.height - playerHeight) {
                    playerY += playerSpeed;
                }
                if (keys["d"] && playerX < canvas.width - playerWidth) {
                    playerX += playerSpeed;
                }

                rect1Y += rectSpeed * rectDirection1;
                rect2Y += rectSpeed * rectDirection2;

                if (rect1Y <= 0 || rect1Y + rectHeight >= canvas.height) {
                    rectDirection1 *= -1;
                }
                if (rect2Y <= 0 || rect2Y + rectHeight >= canvas.height) {
                    rectDirection2 *= -1;
                }

                bullets.forEach(function(bullet, index) {
                    bullet.x += bullet.speedX;
                    bullet.y += bullet.speedY;

                    var dx = playerX + playerWidth / 2 - bullet.x;
                    var dy = playerY + playerHeight / 2 - bullet.y;
                    var distance = Math.sqrt(dx * dx + dy * dy);

                    if (distance < playerWidth / 2 + bulletRadius) {
                        isPlayerAlive = false;
                        showDeathScreen();
                    }
                });

                bullets = bullets.filter(function(bullet) {
                    return bullet.x >= 0 && bullet.x <= canvas.width && bullet.y >= 0 && bullet.y <= canvas.height;
                });
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = "blue";
            ctx.fillRect(playerX, playerY, playerWidth, playerHeight);

            ctx.fillStyle = "red";
            ctx.fillRect(20, rect1Y, rectWidth, rectHeight);
            ctx.fillRect(canvas.width - 40, rect2Y, rectWidth, rectHeight);

            ctx.fillStyle = "black";
            bullets.forEach(function(bullet) {
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, bulletRadius, 0, 2 * Math.PI);
                ctx.fill();
            });

            if (isPlayerAlive) {
                requestAnimationFrame(draw);
            }
        }

        function showDeathScreen() {
            deathScreenElement.style.position = 'absolute';
            deathScreenElement.style.top = '50%';
            deathScreenElement.style.left = '50%';
            deathScreenElement.style.transform = 'translate(-50%, -50%)';
            deathScreenElement.style.color = 'white';
            deathScreenElement.style.fontSize = '24px';
            deathScreenElement.textContent = 'You died!';

            restartButtonElement.textContent = 'Restart';
            restartButtonElement.style.fontSize = '18px';
            restartButtonElement.style.padding = '8px 16px';
            restartButtonElement.style.marginTop = '16px';

            restartButtonElement.addEventListener('click', restartGame);

            document.body.appendChild(deathScreenElement);
            document.body.appendChild(restartButtonElement);
        }

        function restartGame() {
            document.body.removeChild(deathScreenElement);
            document.body.removeChild(restartButtonElement);

            playerX = (canvas.width - playerWidth) / 2;
            playerY = (canvas.height - playerHeight) / 2;
            bullets = [];

            isPlayerAlive = true;

            draw();
        }

        setInterval(update, 16);
        draw();

        setInterval(function() {
            var rect1X = 20 + rectWidth / 2;
            var rect2X = canvas.width - 40 + rectWidth / 2;

            var dx1 = playerX - rect1X;
            var dy1 = playerY - (rect1Y + rectHeight / 2);
            var distance1 = Math.sqrt(dx1 * dx1 + dy1 * dy1);
            var speedX1 = (dx1 / distance1) * bulletSpeed;
            var speedY1 = (dy1 / distance1) * bulletSpeed;

            var dx2 = playerX - rect2X;
            var dy2 = playerY - (rect2Y + rectHeight / 2);
            var distance2 = Math.sqrt(dx2 * dx2 + dy2 * dy2);
            var speedX2 = (dx2 / distance2) * bulletSpeed;
            var speedY2 = (dy2 / distance2) * bulletSpeed;

            var bulletAngleOffset = Math.PI / 6; // Adjust the angle offset here

            bullets.push({ x: rect1X, y: rect1Y + rectHeight / 2, speedX: speedX1 * Math.cos(bulletAngleOffset), speedY: speedY1 * Math.sin(bulletAngleOffset) });
            bullets.push({ x: rect1X, y: rect1Y + rectHeight / 2, speedX: speedX1, speedY: speedY1 });
            bullets.push({ x: rect1X, y: rect1Y + rectHeight / 2, speedX: speedX1 * Math.cos(-bulletAngleOffset), speedY: speedY1 * Math.sin(-bulletAngleOffset) });

            bullets.push({ x: rect2X, y: rect2Y + rectHeight / 2, speedX: speedX2 * Math.cos(bulletAngleOffset), speedY: speedY2 * Math.sin(bulletAngleOffset) });
            bullets.push({ x: rect2X, y: rect2Y + rectHeight / 2, speedX: speedX2, speedY: speedY2 });
            bullets.push({ x: rect2X, y: rect2Y + rectHeight / 2, speedX: speedX2 * Math.cos(-bulletAngleOffset), speedY: speedY2 * Math.sin(-bulletAngleOffset) });
        }, 1000);
    </script>
</body>
</html>
