<!DOCTYPE html>
<html>
<head>
    <title>Game Menu</title>
    <style>
        canvas {
            border: 1px solid black;
            display: block;
            margin: 20px auto;
        }

        #menu {
            text-align: center;
        }

        #menu label {
            display: inline-block;
            margin-bottom: 10px;
        }

        #menu button {
            display: block;
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <div id="menu">
        <h1>Game Menu</h1>
        <label for="playerColor">Player Color:</label>
        <input type="color" id="playerColor">
        <br>
        <label for="difficulty">Difficulty:</label>
        <select id="difficulty">
            <option value="easy">Easy</option>
            <option value="normal" selected>Normal</option>
            <option value="hard">Hard</option>
        </select>
        <br>
        <button id="startButton">Start Game</button>
    </div>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <script>
        var canvas = document.getElementById("gameCanvas");
        var ctx = canvas.getContext("2d");

        var playerColorPicker = document.getElementById("playerColor");
        var playerColor = playerColorPicker.value;

        var difficultySelect = document.getElementById("difficulty");
        var difficulty = difficultySelect.value;
        var difficultyMultiplier = 1;
        if (difficulty === "easy") {
            difficultyMultiplier = 0.5;
        } else if (difficulty === "normal") {
            difficultyMultiplier = 1;
        } else if (difficulty === "hard") {
            difficultyMultiplier = 2;
        }

        var playerX, playerY;
        var playerWidth = 20, playerHeight = 20;
        var bullets = [];
        var rectWidth = 20, rectHeight = 80;
        var rect1Y, rect2Y;
        var collectableRadius = 10;
        var collectables = [];
        var score = 0;
        var startTime;
        var isPlayerAlive = true;

        // Handle start button click event
        var startButton = document.getElementById("startButton");
        startButton.addEventListener("click", function() {
            playerColor = playerColorPicker.value;

            difficulty = difficultySelect.value;
            if (difficulty === "easy") {
                difficultyMultiplier = 0.5;
            } else if (difficulty === "normal") {
                difficultyMultiplier = 1;
            } else if (difficulty === "hard") {
                difficultyMultiplier = 2;
            }

            startGame();
        });

        // Draw the game elements
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw player
            ctx.fillStyle = playerColor;
            ctx.fillRect(playerX, playerY, playerWidth, playerHeight);

            // Draw bullets
            ctx.fillStyle = "#000";
            for (var i = 0; i < bullets.length; i++) {
                ctx.fillRect(bullets[i].x, bullets[i].y, 4, 8);
            }

            // Draw moving rectangles
            ctx.fillStyle = "#000";
            ctx.fillRect(0, rect1Y, rectWidth, rectHeight);
            ctx.fillRect(canvas.width - rectWidth, rect2Y, rectWidth, rectHeight);

            // Draw collectables
            ctx.fillStyle = "#f00";
            for (var i = 0; i < collectables.length; i++) {
                ctx.beginPath();
                ctx.arc(collectables[i].x, collectables[i].y, collectableRadius, 0, Math.PI * 2);
                ctx.fill();
            }

            // Draw score and time
            ctx.fillStyle = "#000";
            ctx.font = "16px Arial";
            ctx.fillText("Score: " + score, 10, 20);
            var currentTime = Date.now();
            var elapsedTime = currentTime - startTime;
            ctx.fillText("Time: " + formatTime(elapsedTime), 10, 40);
        }

        // Update the game logic
        function update() {
            var playerSpeed = 4;

            // Move player
            if (keys[38] && playerY > 0) {
                playerY -= playerSpeed;
            }
            if (keys[40] && playerY < canvas.height - playerHeight) {
                playerY += playerSpeed;
            }
            if (keys[37] && playerX > 0) {
                playerX -= playerSpeed;
            }
            if (keys[39] && playerX < canvas.width - playerWidth) {
                playerX += playerSpeed;
            }

            // Move rectangles
            rect1Y += 2 * difficultyMultiplier;
            rect2Y -= 2 * difficultyMultiplier;

            // Check collision with player
            if (checkCollision(playerX, playerY, playerWidth, playerHeight, 0, rect1Y, rectWidth, rectHeight) ||
                checkCollision(playerX, playerY, playerWidth, playerHeight, canvas.width - rectWidth, rect2Y, rectWidth, rectHeight)) {
                isPlayerAlive = false;
            }

            // Move bullets
            for (var i = 0; i < bullets.length; i++) {
                bullets[i].y -= 5;
                if (bullets[i].y < 0) {
                    bullets.splice(i, 1);
                    i--;
                } else {
                    // Check collision with collectables
                    for (var j = 0; j < collectables.length; j++) {
                        if (checkCollision(bullets[i].x, bullets[i].y, 4, 8, collectables[j].x - collectableRadius, collectables[j].y - collectableRadius, collectableRadius * 2, collectableRadius * 2)) {
                            collectables.splice(j, 1);
                            j--;
                            bullets.splice(i, 1);
                            i--;
                            score++;
                            break;
                        }
                    }
                }
            }

            // Generate new collectables
            if (Math.random() < 0.01 * difficultyMultiplier) {
                collectables.push({
                    x: Math.random() * (canvas.width - collectableRadius * 2) + collectableRadius,
                    y: Math.random() * (canvas.height - collectableRadius * 2) + collectableRadius
                });
            }
        }

        // Game loop
        function gameLoop() {
            if (isPlayerAlive) {
                update();
                draw();
                requestAnimationFrame(gameLoop);
            } else {
                alert("Game Over! Your score is: " + score);
            }
        }

        // Start the game
        function startGame() {
            playerX = (canvas.width - playerWidth) / 2;
            playerY = (canvas.height - playerHeight) / 2;
            isPlayerAlive = true;
            bullets = [];
            rect1Y = 0;
            rect2Y = canvas.height - rectHeight;
            collectables = [];
            score = 0;
            startTime = Date.now();
            gameLoop();
        }

        // Handle keyboard events
        var keys = {};
        window.addEventListener("keydown", function(event) {
            keys[event.keyCode] = true;
        });
        window.addEventListener("keyup", function(event) {
            delete keys[event.keyCode];
        });

        // Check collision between two rectangles
        function checkCollision(x1, y1, w1, h1, x2, y2, w2, h2) {
            return x1 < x2 + w2 &&
                   x1 + w1 > x2 &&
                   y1 < y2 + h2 &&
                   y1 + h1 > y2;
        }

        // Format time in mm:ss format
        function formatTime(time) {
            var minutes = Math.floor(time / 60000);
            var seconds = Math.floor((time % 60000) / 1000);
            return minutes + ":" + (seconds < 10 ? "0" : "") + seconds;
        }

        // Initialize game
        startGame();
    </script>
</body>
</html>
