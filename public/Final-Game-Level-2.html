<!DOCTYPE html>
<html>
<head>
    <title>Simple Game</title>
    <style>
        canvas {
            border: 1px solid black;
        }
        #highScoreContainer {
            margin-top: 20px;
            padding: 10px;
            background-color: #ff5555;
            color: white;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="600" height="400"></canvas>
    <div id="highScoreContainer"></div>

    <script>
        var canvas = document.getElementById("gameCanvas");
        var ctx = canvas.getContext("2d");

        var playerWidth = 50;
        var playerHeight = 50;
        var playerX = (canvas.width - playerWidth) / 2;
        var playerY = (canvas.height - playerHeight) / 2;
        var rectWidth = 20;
        var rectHeight = 100;
        var rect1Y = 0;
        var rect2Y = canvas.height - rectHeight;
        var bulletRadius = 5;
        var collectableRadius = 10;
        var collectableSpawnInterval = 2000;
        var lastCollectableSpawnTime = -collectableSpawnInterval;
        var bullets = [];
        var enemies = [];
        var enemyBullets = [];
        var enemySize = 20;
        var enemySpeed = 2;
        var enemyBulletSpeed = 3;
        var enemyBulletCount = 1;
        var score = 0;
        var highScore = 0;
        var highScoreContainer = document.getElementById("highScoreContainer");
        var isPlayerAlive = true;
        var startTime = Date.now();

        // Generate random number between min and max
        function randomRange(min, max) {
            return Math.random() * (max - min) + min;
        }

        // Check if two objects collide
        function checkCollision(obj1, obj2) {
            var dx = obj1.x - obj2.x;
            var dy = obj1.y - obj2.y;
            var distance = Math.sqrt(dx * dx + dy * dy);
            return distance < obj1.radius + obj2.radius;
        }

        // Update game state
        function update() {
            // Move the player
            if (isPlayerAlive) {
                if (rect1Y > 0 && rect1Y + rectHeight < canvas.height) {
                    rect1Y += Math.floor(randomRange(-5, 5));
                }
                if (rect2Y > 0 && rect2Y + rectHeight < canvas.height) {
                    rect2Y += Math.floor(randomRange(-5, 5));
                }
            }

            // Move the bullets
            bullets.forEach(function(bullet) {
                bullet.y -= 5;
            });

            // Move the enemies
            enemies.forEach(function(enemy) {
                enemy.y += enemySpeed;
                if (enemy.y > canvas.height) {
                    enemy.y = -enemySize;
                    enemy.x = randomRange(0, canvas.width - enemySize);
                }
            });

            // Move the enemy bullets
            enemyBullets.forEach(function(bullet) {
                bullet.y += enemyBulletSpeed;
            });

            // Check for bullet-enemy collision
            bullets.forEach(function(bullet, bulletIndex) {
                enemies.forEach(function(enemy, enemyIndex) {
                    if (checkCollision(bullet, enemy)) {
                        bullets.splice(bulletIndex, 1);
                        enemies.splice(enemyIndex, 1);
                        score += 10;
                    }
                });
            });

            // Check for player-enemy collision
            if (isPlayerAlive) {
                enemies.forEach(function(enemy) {
                    if (checkCollision(enemy, { x: playerX, y: playerY, radius: playerWidth / 2 })) {
                        isPlayerAlive = false;
                        if (score > highScore) {
                            highScore = score;
                            highScoreContainer.textContent = "High Score: " + highScore;
                        }
                    }
                });
            }

            // Check for enemy bullet-player collision
            if (isPlayerAlive) {
                enemyBullets.forEach(function(bullet) {
                    if (checkCollision(bullet, { x: playerX, y: playerY, radius: playerWidth / 2 })) {
                        isPlayerAlive = false;
                        if (score > highScore) {
                            highScore = score;
                            highScoreContainer.textContent = "High Score: " + highScore;
                        }
                    }
                });
            }

            // Spawn collectables
            var currentTime = Date.now();
            if (currentTime - lastCollectableSpawnTime > collectableSpawnInterval) {
                var collectableX = randomRange(collectableRadius, canvas.width - collectableRadius);
                var collectableY = randomRange(collectableRadius, canvas.height - collectableRadius);
                var collectable = { x: collectableX, y: collectableY, radius: collectableRadius };
                enemies.forEach(function(enemy) {
                    if (checkCollision(collectable, enemy)) {
                        return;
                    }
                });
                bullets.forEach(function(bullet) {
                    if (checkCollision(collectable, bullet)) {
                        return;
                    }
                });
                enemyBullets.forEach(function(bullet) {
                    if (checkCollision(collectable, bullet)) {
                        return;
                    }
                });
                playerX = randomRange(collectableRadius, canvas.width - collectableRadius);
                playerY = randomRange(collectableRadius, canvas.height - collectableRadius);
                lastCollectableSpawnTime = currentTime;
            }

            // Increase enemy bullet count and player size reduction every 100 points
            if (score % 100 === 0 && score > 0) {
                enemyBulletCount++;
                playerWidth -= 5;
                playerHeight -= 5;
                playerX = (canvas.width - playerWidth) / 2;
                playerY = (canvas.height - playerHeight) / 2;
            }

            // Clear the canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw the player
            ctx.fillStyle = "blue";
            ctx.fillRect(playerX, playerY, playerWidth, playerHeight);

            // Draw the bullets
            ctx.fillStyle = "black";
            bullets.forEach(function(bullet) {
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, bullet.radius, 0, Math.PI * 2);
                ctx.fill();
            });

            // Draw the enemies
            ctx.fillStyle = "red";
            enemies.forEach(function(enemy) {
                ctx.fillRect(enemy.x, enemy.y, enemySize, enemySize);
            });

            // Draw the enemy bullets
            ctx.fillStyle = "black";
            enemyBullets.forEach(function(bullet) {
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, bullet.radius, 0, Math.PI * 2);
                ctx.fill();
            });

            // Draw the player score
            ctx.fillStyle = "black";
            ctx.font = "20px Arial";
            ctx.fillText("Score: " + score, 10, 30);

            // Schedule the next update
            requestAnimationFrame(update);
        }

        // Initialize the game
        update();
    </script>
</body>
</html>
